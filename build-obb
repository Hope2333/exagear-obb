#!/bin/bash

set -xe

basedir=$PWD/build
downloads=$basedir/packaging
tools=$basedir/tools
silent=--silent
sourcedir=$(cd $(dirname $0) && pwd)
release=$1
pkgdir=$PWD/zip-building
pkgver=$release
channel=bionic


#
download ()
{
    test -d $downloads || mkdir -p $downloads
    test -f $downloads/$(basename $2) || wget -O $downloads/$(basename $2) ${3:-$2}
    rm -rf $1
    case $2 in
        *.zip)
            unzip -q $downloads/$(basename $2) ;;
        *)
            tar xf $downloads/$(basename $2) ;;
	*.deb)
	    bsdtar -xf $downloads/$(basename $2) -C $1
	    bsdtar -xf $1/data.tar.xz -C $pkgdir/ ;;
    esac
}


first ()
{
test -z "$release" || rm -rf $basedir
test -z "$release" || rm -rf $pkgdir
test -d $basedir || mkdir $basedir
test -d $pkgdir || mkdir $pkgdir
cd $basedir
}

config_mainzip ()
{
    mkdir -p base
    cd base
    download base base-all.zip URL
    #download base base-minimal1.zip URL
    cd ..
}

config_wine-devel-i386 ()
{
    mkdir -p wine-devel-i386
    cd wine-devel-i386
    download wine-devel-i386 wine-devel-i386.deb https://dl.winehq.org/wine-builds/ubuntu/dists/${channel}/main/binary-i386/wine-devel-i386_${pkgver}~${channel}-1_i386.deb
    cd ..
}

config_wine-devel ()
{
    mkdir -p wine-devel
    cd wine-devel
    download wine-devel wine-devel.deb https://dl.winehq.org/wine-builds/ubuntu/dists/${channel}/main/binary-i386/wine-devel_${pkgver}~${channel}-1_i386.deb
    cd ..
}

config_winehq-devel ()
{
    mkdir -p winehq-devel
    cd winehq-devel
    download winehq-devel winehq-devel.deb https://dl.winehq.org/wine-builds/ubuntu/dists/${channel}/main/binary-i386/winehq-devel_${pkgver}~${channel}-1_i386.deb
    cd ..
}

install-all ()
{
    cd $pkgdir
    sudo zip --symlink -r -9 ../wine-dev-$release.zip .
}

#OldMain

mkdir zip-building
unzip base-all.zip -d zip-building
#unzip base-minimal*.zip -d zip-building
cd zip-building
tar -xvJf ../in/1wine-devel-i386.tar.xz
tar -xvJf ../in/2wine-devel.tar.xz
tar -xvJf ../in/3winehq-devel.tar.xz
sudo zip --symlink -r -9 ~/wine-dev-6.ver.zip .
cd 
sudo rm -rf zip-building

#Main
first
config_mainzip
test -d wine-devel-i386 || config_wine-devel-i386
test -d wine-devel || config_wine-devel
test -d winehq-devel || config_winehq-devel
test -d $pkgdir || install-all
